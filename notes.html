<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>View Notes | GEC Note Vault</title>
  <style>
    * { box-sizing: border-box; margin:0; padding:0; font-family: Arial, sans-serif; }
    body { background:#f5f7fa; display:flex; flex-direction:column; min-height:100vh; }
    nav {
      background:#4a90e2;
      color:white;
      padding:15px 30px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    nav h1 { display:flex; align-items:center; font-size:24px; }
    nav h1 img { width:35px; height:35px; margin-right:10px; }
    .nav-links a { color:white; text-decoration:none; margin-left:15px; font-weight:bold; }
    .nav-links a:hover { text-decoration:underline; }
    main { flex:1; padding:30px 20px; }
    .filter-row {
      display:flex;
      gap:15px;
      justify-content:center;
      margin-bottom:25px;
      flex-wrap:wrap;
    }
    select {
      padding:10px 15px;
      border-radius:8px;
      border:1px solid #ccc;
      font-size:16px;
    }
    button {
      padding:10px 20px;
      border:none;
      border-radius:8px;
      background:#4a90e2;
      color:white;
      font-weight:bold;
      cursor:pointer;
      transition: background 0.2s;
    }
    button:hover { background:#357ab8; }
    .notes-grid {
      display:grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap:20px;
    }
    .note-card {
      background:white;
      border-radius:10px;
      padding:20px;
      box-shadow:0 4px 10px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }
    .note-card:hover { transform:scale(1.02); }
    .note-card h3 { color:#4a90e2; margin-bottom:10px; }
    .note-card p { margin:5px 0; font-size:15px; color:#333; }
    .note-card a {
      display:inline-block;
      margin-top:10px;
      text-decoration:none;
      color:white;
      background:#4a90e2;
      padding:8px 12px;
      border-radius:6px;
    }
    .note-card a:hover { background:#357ab8; }
    footer { text-align:center; padding:20px; background:#e1ecf7; color:#333; font-size:14px; margin-top:40px; }
    @media(max-width:480px){
      .filter-row { flex-direction:column; align-items:center; }
    }
  </style>
</head>
<body>
  <nav>
    <h1><img src="logo.jpg" alt="Logo">GEC Note Vault</h1>
    <div class="nav-links">
      <a href="dashboard.html">Dashboard</a>
      <a href="upload.html">Upload</a>
    </div>
  </nav>
  <main>
    <div class="filter-row">
      <select id="filterDept">
        <option value="">All Departments</option>
        <option value="CSE">CSE</option>
        <option value="IT">IT</option>
        <option value="ETC">ETC</option>
        <option value="EEE">EEE</option>
        <option value="ME">ME</option>
        <option value="CI">CI</option>
        <option value="VLSI">VLSI</option>
      </select>
      <select id="filterYear">
        <option value="">All Years</option>
        <option value="1st Year">1st Year</option>
        <option value="2nd Year">2nd Year</option>
        <option value="3rd Year">3rd Year</option>
        <option value="4th Year">4th Year</option>
      </select>
      <select id="filterType">
        <option value="">All File Types</option>
        <option value="pdf">PDF</option>
        <option value="image">Image</option>
        <option value="pyq">PYQ</option>
      </select>
      <button id="applyFilters">Apply Filters</button>
    </div>
    <div class="notes-grid" id="notesGrid">
      <p>Loading notes...</p>
    </div>
  </main>
  <footer>
    &copy; 2025 GEC Note Vault | All rights reserved
  </footer>
  <script type="module">
    import { createClient } from "https://esm.sh/@supabase/supabase-js";
    const SUPABASE_URL = "https://zfiuzdmionjolmbedvpk.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InpmaXV6ZG1pb25qb2xtYmVkdnBrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1Nzk2MzUsImV4cCI6MjA3NzE1NTYzNX0.d2fmy2Fzx26YCJc9tRCykDWrgJHXlzSpXwlnaUj1KrU";
    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    const notesGrid = document.getElementById("notesGrid");
    const filterDept = document.getElementById("filterDept");
    const filterYear = document.getElementById("filterYear");
    const filterType = document.getElementById("filterType");
    const applyFilters = document.getElementById("applyFilters");

    async function fetchNotes() {
      let query = supabase.from("notes").select("*").order("id", { ascending: false });
      if (filterDept.value) query = query.eq("department", filterDept.value);
      if (filterYear.value) query = query.eq("year", filterYear.value);
      if (filterType.value) query = query.eq("file_type", filterType.value);

      const { data, error } = await query;
      if (error) {
        notesGrid.innerHTML = `<p>Error loading notes: ${error.message}</p>`;
        return;
      }
      if (!data || data.length === 0) {
        notesGrid.innerHTML = "<p>No notes found for selected filters.</p>";
        return;
      }

      notesGrid.innerHTML = data.map(note => `
        <div class="note-card">
          <h3>${note.subject}</h3>
          <p><b>Topic:</b> ${note.topic}</p>
          <p><b>Department:</b> ${note.department}</p>
          <p><b>Year:</b> ${note.year}</p>
          <p><b>Type:</b> ${note.file_type}</p>
          <p>${note.description}</p>
          <a href="${note.file_url}" target="_blank">ðŸ“‚ View File</a>
        </div>
      `).join("");
    }

    applyFilters.addEventListener("click", fetchNotes);
    fetchNotes();
  </script>
</body>
</html>